@model WebApplication1.ViewModels.SaleInvVM
@{
    ViewBag.Title = "Index";
}
<style>
    .chosen-container {
        width: 100% !important;
    }
</style>
<script>
    var showLoader = function (form) {
        $("<div />").css({
            'position': 'fixed',
            'left': 0,
            'right': 0,
            'bottom': 0,
            'top': 0,
            'background': '#0020ff36',
            'z-index': '99',
            'text-align': 'center'
        }).appendTo($("body"))
            .append(
                $("<img />").attr("src", "https://mir-s3-cdn-cf.behance.net/project_modules/disp/35771931234507.564a1d2403b3a.gif")
            );
    }

    function Action(code) {
        $.ajax({
            /**/
            url: '@Url.Action("Action", "Batch")',
            /**/
            type: "POST",
            data: { "code": code },

            "success": function (data) {
                if (data != null) {
                    var vdata = data;
                    $("#rate1").val(vdata[0].UnitPrice);
                    $("#id1").val(vdata[0].ProductID);
                    $("#id1").val(vdata[0].ProductID);
                }
            }
        });
    }
    function Action1(code) {
        $.ajax({
            /**/
            url: '@Url.Action("Action", "Batch")',
            /**/
            type: "POST",
            data: { "code": code },

            "success": function (data) {
                if (data != null) {
                    var vdata = data;
                    $("#rate2").val(vdata[0].UnitPrice);
                    $("#id2").val(vdata[0].ProductID);
                }
            }
        });
    }
    function Action2(code) {
        //alert(code);
        $.ajax({
            /**/
            url: '@Url.Action("Action1", "Batch")',
            /**/
            type: "POST",
            data: { "code": code },

            "success": function (data) {
                if (data != null) {
                    var vdata = data;
                  // alert(vdata);
                    $("#itmdisc").val(vdata[0].itmdisc);
                }
            }
        });
    }

    function addrecord(code, enterweight,Totalweight) {



        $.ajax({

            url: '@Url.Action("addrecord", "Batch")',

            type: "POST",

            data: { "code": code},

            "success": function (data) {
                if (data != null) {
                    var vdata = data;
                    var htmlRows = '';
                    if (enterweight != 0 && enterweight != null) {

                        for (var i = 0; i < data.length; i++) {

                            htmlRows += '<tr data-editing="false">';
                            htmlRows += '<td style="width:80px !important"><a class="badge badge-xs x-danger b-rounded" onclick="return deleteRow(this)" ><i class="fa fa-trash-o"></i></a><a class="label label-warning shiny input-xs" onclick="editRow(this)"><i class="fa fa-pencil"></i></a></td>';
                            htmlRows += '<td><input type="text"  name="id1[]"  value="' + data[i].ItemId + '" required class="form-control" readonly autocomplete="off"></td>';
                            htmlRows += '<td><input type="text" name="date1[]" value="' + data[i].Date1 + '" required class="form-control" readonly autocomplete="off"></td>';
                             htmlRows += '<td><input type="text"  name="item_name1[]"  value="' + data[i].ItemName + '" readonly class="form-control" autocomplete="off"></td>';
                            var weight = parseFloat(data[i].weight / Totalweight * enterweight).toFixed(3);
                            var str = "";
                            if (data[i].ext1 < weight) {
                                str = 'style="background-color:red;"';
                            }
                            htmlRows += '<td><input type="text" '+str+'  name="weight1[]"   value="' + weight + ' "  onKeyUp="totacost(this);" readonly class="form-control" autocomplete="off"></td>';
                            str = "";
                            htmlRows += '<td><input type="text"  name="rate1[]"  value="' + data[i].Rate + '"   readonly class="form-control" autocomplete="off"></td>';
                            var cost = parseFloat(data[i].Rate * weight).toFixed(3);
                            htmlRows += '<td><input type="text"  name="cost1[]"  value="' + cost + '"   readonly class="form-control" autocomplete="off"></td>';
                            htmlRows += '<td name="cost2[]" style="display:none">' + cost + '</td>';
                            htmlRows += '<td name="weight2[]" style="display:none">' + weight + '</td>';
                            htmlRows += '<td name="persent2[]" style="display:none"></td>';
                            htmlRows += '<td></td></tr>';
                        }
                    }
                    else {
                        for (var i = 0; i < data.length; i++) {

                            htmlRows += '<tr data-editing="false">';
                            htmlRows += '<td style="width:80px !important"><a class="badge badge-xs x-danger b-rounded" onclick="return deleteRow(this)" ><i class="fa fa-trash-o"></i></a><a class="label label-warning shiny input-xs" onclick="editRow(this)"><i class="fa fa-pencil"></i></a></td>';
                            htmlRows += '<td><input type="text"  name="id1[]"  value="' + data[i].ItemId + '" required class="form-control" readonly autocomplete="off"></td>';
                            htmlRows += '<td><input type="text" name="date1[]" value="' + data[i].Date1 + '" required class="form-control" readonly autocomplete="off"></td>';
                            htmlRows += '<td><input type="text"  name="item_name1[]"  value="' + data[i].ItemName + '" readonly class="form-control" autocomplete="off"></td>';
                            var str = "";
                            if (data[i].ext1 < data[i].weight) {
                                str = 'style="background-color:red;"';
                            }
                            htmlRows += '<td><input type="text" ' + str +'  name="weight1[]"   value="' + data[i].weight + ' "  onKeyUp="totacost(this);" readonly class="form-control" autocomplete="off"></td>';
                            str = "";
                            htmlRows += '<td><input type="text"  name="rate1[]"  value="' + data[i].Rate + '"   readonly class="form-control" autocomplete="off"></td>';
                            htmlRows += '<td><input type="text"  name="cost1[]"  value="' + data[i].Cost + '"   readonly class="form-control" autocomplete="off"></td>';
                            htmlRows += '<td name="cost2[]" style="display:none">' + data[i].Cost + '</td>';
                            htmlRows += '<td name="weight2[]" style="display:none">' + data[i].weight + '</td>';
                            htmlRows += '<td name="persent2[]" style="display:none"></td>';
                            htmlRows += '<td></td></tr>';
                        }
                    }
                    $('#invoiceItem').append(htmlRows);
                    calcutateaddrecord();
                }
            }
        });

    }
    function editRow(element) {
        var row = $(element).closest('tr');
        var isEditing = row.attr('data-editing') === 'true';

        if (!isEditing) {
            // Enable editing
            row.find('input[name="weight1[]"]').prop('readonly', false);
            //row.find('input[name="rate1[]"]').prop('readonly', false);
            $(element).html('<i class="fa fa-floppy-o"></i> ');

            // Update the value attribute of input fields with current values

            row.attr('data-editing', 'true');
        } else {
            // Disable editing
            // row.find('input').prop('readonly', true);
            row.find('input[name="weight1[]"]').prop('readonly', true);
            //row.find('input[name="rate1[]"]').prop('readonly', true);
            $(element).html('<i class="fa fa-pencil"></i> ');
            row.find('input').each(function () {
                $(this).attr('value', $(this).val());
            });

            row.attr('data-editing', 'false');
        }
    }

    function totacost(element) {
        var row = $(element).closest('tr');
        var weightInput = row.find('input[name="weight1[]"]');
        var rateInput = row.find('input[name="rate1[]"]');

        var rateInput2 = row.find('td[name="cost2[]"]');
        var weightInput2 = row.find('td[name="weight2[]"]');

        var persent2 = row.find('td[name="persent2[]"]');

        var weight1 = weightInput.val();
        var rate1 = rateInput.val();


        if (!isNaN(weight1) && !isNaN(rate1)) {
            var total = weight1 * rate1;

            
            weightInput.val(weight1);
            rateInput.val(rate1);
            row.find('input[name="cost1[]"]').val(total);

            rateInput2.text(total);
            weightInput2.text(weight1);

            calcutateaddrecord();
            
        } else {
            console.error("Invalid weight1 or rate1 value");
        }
    }
    function calcutateaddrecord() {

        var table = document.getElementById("invoiceItem"), sumVal = 0;
        for (var i = 1; i < table.rows.length; i++) {
            sumVal = sumVal + parseFloat(table.rows[i].cells[8].innerHTML);
        }
        document.getElementById("weight1tot").value = sumVal;

        var tot_weight = document.getElementById("weight1tot").value;
        var table = document.getElementById("invoiceItem");
        //alert(tot_weight);
        for (var i = 1; i < table.rows.length; i++) {
            var weight = table.rows[i].cells[8].innerHTML;
            var tot = 0;
            // alert(weight);
            //alert(tot_weight);
            if (tot_weight != 0) {
                tot = (weight * 100) / tot_weight;
            }
            else {
                tot = 100.00;
            }
            table.rows[i].cells[9].innerHTML = tot.toFixed(3);
            table.rows[i].cells[10].innerHTML = '<input type="text"  name="per1"  value=' + tot.toFixed(3) + '  readonly class="form-control" autocomplete="off">';

        }

        $('#id1').val('');
        $('#item_name1').val('');
        $('#weight1').val('0');
        $('#rate1').val('0');
        $('#cost1').val('0');
        $('#per1').val('0');
        $('#rate1drop').val('');
        $('#rem1').val('0');

        var table = document.getElementById("invoiceItem"), sumVal = 0;
        for (var i = 1; i < table.rows.length; i++) {
            sumVal = sumVal + parseFloat(table.rows[i].cells[9].innerHTML);
        }
        document.getElementById("t_per").value = sumVal;

        var table = document.getElementById("invoiceItem"), sumVal = 0;
        for (var i = 1; i < table.rows.length; i++) {
            sumVal = sumVal + parseFloat(table.rows[i].cells[7].innerHTML);
        }
        document.getElementById("t_cost").value = sumVal;

        //Calculta Total weight

        var w1 = document.getElementById("weight1tot").value;
        var w2 = document.getElementById("weight2tot").value;
        document.getElementById("weighttot").value = parseFloat(w1) + parseFloat(w2);

        //Calculta 1kg cost

        var cost1 = document.getElementById("t_cost").value;
        var cost2 = document.getElementById("t_cost1").value;
        var weighttot = document.getElementById("weighttot").value;
        var sum = parseFloat(cost1) + parseFloat(cost2);
        document.getElementById("1kgcost").value = parseFloat(sum) / parseFloat(weighttot);
        document.getElementById("tot_cost").value = parseFloat(sum);

        var kgcost = parseFloat(document.getElementById("1kgcost").value);
        var itmdisc = parseFloat(document.getElementById("itmdisc").value);


        if (kgcost > itmdisc) {
            var inputVal = document.getElementById("1kgcost");
            inputVal.style.backgroundColor = "red";
        }

    }


    function tota() {
        var weight1 = document.getElementById("weight1").value;
        var selObj = document.getElementById("rate1drop");
        var rate1 = selObj.options[selObj.selectedIndex].value;
        var totl;
        totl = weight1 * rate1;
        document.getElementById("cost1").value = totl;

       // var table = document.getElementById("invoiceItem"), sumVal = 0;
       // for (var i = 1; i < table.rows.length; i++) {
       //     sumVal = sumVal + parseInt(table.rows[i].cells[9].innerHTML);
       // }
       // document.getElementById("weight1tot").value = parseFloat(sumVal);
       //// alert(sumVal);
       // if (sumVal != 0) {
       //    // alert("first");
       //     var new_weight = (sumVal * weight1) / 100;
       //     document.getElementById("per1").value = parseFloat(new_weight);
       // }
       // else {
       //    // alert("second");
       //     var new_weight = (weight1 * weight1) / 100;
       //     document.getElementById("per1").value = parseFloat(new_weight);
       // }




    }
    function add() {
        /* var id = document.getElementById("id1").value;*/
        var selObj = document.getElementById("item_name1");
        var item_name1 = selObj.options[selObj.selectedIndex].text;
        var id = selObj.options[selObj.selectedIndex].value;
        var sp = document.getElementById("weight1").value;
        var rem1 = document.getElementById("rem1").value;

        var total = document.getElementById("cost1").value;
        var date = document.getElementById("date1").value;
        var per1 = document.getElementById("per1").value;
        var selObj1 = document.getElementById("rate1drop");
        var rate1 = selObj1.options[selObj1.selectedIndex].value;
        if (parseFloat(sp) > parseFloat(rem1)) {

            alert("Stock Not Available!");
        }
        else {
        var htmlRows = '';
        htmlRows += '<tr>';
        htmlRows += '<td style="width:80px !important"><a class="badge badge-xs x-danger b-rounded" onclick="return deleteRow(this)" ><i class="fa fa-trash-o"></i></a></td>';
        htmlRows += '<td><input type="text"  name="id1[]"  value="' + id + '" required class="form-control" readonly autocomplete="off"></td>';
        htmlRows += '<td><input type="text"  name="date1[]"  value="' + date + '" required class="form-control" readonly autocomplete="off"></td>';
        htmlRows += '<td><input type="text"  name="item_name1[]"  value="' + item_name1 + '" readonly class="form-control" autocomplete="off"></td>';
        htmlRows += '<td><input type="text"  name="weight1[]"  value="' + sp + ' "   readonly class="form-control" autocomplete="off"></td>';
        /* htmlRows += '<td><input type="text"  name="per1[]"  value="' + per1 + '"  readonly class="form-control" autocomplete="off"></td>';*/
        htmlRows += '<td><input type="text"  name="rate1[]"  value="' + rate1 + '"   readonly class="form-control" autocomplete="off"></td>';
        htmlRows += '<td><input type="text"  name="cost1[]"  value="' + total + '"   readonly class="form-control" autocomplete="off"></td>';
        htmlRows += '<td style="display:none">' + total + '</td>';
        htmlRows += '<td style="display:none">' + sp + '</td>';
        htmlRows += '<td style="display:none"></td>';
        htmlRows += '<td></td>';

        $('#invoiceItem').append(htmlRows);


        var table = document.getElementById("invoiceItem"), sumVal = 0;
        for (var i = 1; i < table.rows.length; i++) {
            sumVal = sumVal + parseFloat(table.rows[i].cells[8].innerHTML);
        }
        document.getElementById("weight1tot").value = sumVal;

        var tot_weight = document.getElementById("weight1tot").value;
        var table = document.getElementById("invoiceItem");
        //alert(tot_weight);
        for (var i = 1; i < table.rows.length; i++) {
            var weight = table.rows[i].cells[8].innerHTML;
            var tot = 0;
            // alert(weight);
            //alert(tot_weight);
            if (tot_weight != 0) {
                tot = (weight * 100) / tot_weight;
            }
            else {
                tot = 100.00;
            }
            table.rows[i].cells[9].innerHTML = tot.toFixed(3);
            table.rows[i].cells[10].innerHTML = '<input type="text"  name="per1"  value=' + tot.toFixed(3) + '  readonly class="form-control" autocomplete="off">';

        }

        $('#id1').val('');
        $('#item_name1').val('');
        $('#weight1').val('0');
        $('#rate1').val('0');
        $('#cost1').val('0');
        $('#per1').val('0');
        $('#rate1drop').val('');
        $('#rem1').val('0');

        var table = document.getElementById("invoiceItem"), sumVal = 0;
        for (var i = 1; i < table.rows.length; i++) {
            sumVal = sumVal + parseFloat(table.rows[i].cells[9].innerHTML);
        }
        document.getElementById("t_per").value = sumVal;

        var table = document.getElementById("invoiceItem"), sumVal = 0;
        for (var i = 1; i < table.rows.length; i++) {
            sumVal = sumVal + parseFloat(table.rows[i].cells[7].innerHTML);
        }
        document.getElementById("t_cost").value = sumVal;

        //Calculta Total weight
        //var w1 = document.getElementById("weight1tot").value;
        //var w2 = document.getElementById("weight2tot").value;
        //document.getElementById("weighttot").value = parseFloat(w1) + parseFloat(w2);

        //Calculta 1kg cost

        var cost1 = document.getElementById("t_cost").value;
        //var cost2 = document.getElementById("t_cost1").value;
        var weighttot = document.getElementById("weight1tot").value;
        //var sum = parseFloat(cost1) + parseFloat(cost2);
        document.getElementById("1kgcost").value = parseFloat(cost1) / parseFloat(weighttot);
    }

    }
    function tota1() {
        //  alert("text");
        var weight1 = document.getElementById("weight2").value;
        var rate1 = document.getElementById("rate2").value;
        var totl;
        totl = weight1 * rate1;
        document.getElementById("cost2").value = totl;

        var table = document.getElementById("invoiceItem1"), sumVal = 0;
        for (var i = 1; i < table.rows.length; i++) {
            sumVal = sumVal + parseInt(table.rows[i].cells[9].innerHTML);
        }
        document.getElementById("weight2tot").value = parseFloat(sumVal);
        // alert(sumVal);
        if (sumVal != 0) {
            // alert("first");
            var new_weight = (sumVal * weight1) / 100;
            document.getElementById("per2").value = parseFloat(new_weight);
        }
        else {
            // alert("second");
            var new_weight = (weight1 * weight1) / 100;
            document.getElementById("per2").value = parseFloat(new_weight);
        }

    }
    function add1() {
        var id = document.getElementById("id2").value;
        var selObj = document.getElementById("item_name2");
        var item_name1 = selObj.options[selObj.selectedIndex].text;
        var sp = document.getElementById("weight2").value;
        var rate1 = document.getElementById("rate2").value;
        var total = document.getElementById("cost2").value;
        var date = document.getElementById("date2").value;
        var per1 = document.getElementById("per2").value;
        var htmlRows = '';
        htmlRows += '<tr>';
        htmlRows += '<td style="width:80px !important"><a class="badge badge-xs x-danger b-rounded" onclick="return deleteRow1(this)" ><i class="fa fa-trash-o"></i></a></td>';
        htmlRows += '<td><input type="text"  name="id2[]"  value="' + id + '" required class="form-control" readonly autocomplete="off"></td>';
        htmlRows += '<td><input type="text"  name="date2[]"  value="' + date + '" required class="form-control" readonly autocomplete="off"></td>';
        htmlRows += '<td><input type="text"  name="item_name2[]"  value="' + item_name1 + '" readonly class="form-control" autocomplete="off"></td>';
        htmlRows += '<td><input type="text"  name="weight2[]"  value="' + sp + ' "   readonly class="form-control" autocomplete="off"></td>';
        //htmlRows += '<td><input type="text"  name="per2[]"  value="' + per1 + '"  readonly class="form-control" autocomplete="off"></td>';
        htmlRows += '<td><input type="text"  name="rate2[]"  value="' + rate1 + '"   readonly class="form-control" autocomplete="off"></td>';
        htmlRows += '<td><input type="text"  name="cost2[]"  value="' + total + '"   readonly class="form-control" autocomplete="off"></td>';
        htmlRows += '<td style="display:none">' + total + '</td>';
        htmlRows += '<td style="display:none">' + sp + '</td>';
        htmlRows += '<td style="display:none"></td>';
        htmlRows += '<td></td>';

        $('#invoiceItem1').append(htmlRows);
        var table = document.getElementById("invoiceItem1"), sumVal = 0;
        for (var i = 1; i < table.rows.length; i++) {
            sumVal = sumVal + parseFloat(table.rows[i].cells[8].innerHTML);
        }
        document.getElementById("weight2tot").value = sumVal;

        var tot_weight = document.getElementById("weight2tot").value;
        var table = document.getElementById("invoiceItem1");
        //alert(tot_weight);
        for (var i = 1; i < table.rows.length; i++) {
            var weight = table.rows[i].cells[8].innerHTML;
            var tot = 0;
            // alert(weight);
            //alert(tot_weight);
            if (tot_weight != 0) {
                tot = (weight * 100) / tot_weight;
            }
            else {
                tot = 100.00;
            }
            table.rows[i].cells[9].innerHTML = tot.toFixed(3);
            table.rows[i].cells[10].innerHTML = '<input type="text"  name="per2"  value=' + tot.toFixed(3) + '  readonly class="form-control" autocomplete="off">';

        }

        $('#id2').val('');
        $('#item_name2').val('');
        $('#weight2').val('0');
        $('#rate2').val('0');
        $('#cost2').val('0');
        $('#per2').val('0');

        var table = document.getElementById("invoiceItem1"), sumVal = 0;
        for (var i = 1; i < table.rows.length; i++) {
            sumVal = sumVal + parseFloat(table.rows[i].cells[9].innerHTML);
        }
        document.getElementById("t_per1").value = sumVal;

        var table = document.getElementById("invoiceItem1"), sumVal = 0;
        for (var i = 1; i < table.rows.length; i++) {
            sumVal = sumVal + parseFloat(table.rows[i].cells[7].innerHTML);
        }
        document.getElementById("t_cost1").value = sumVal;

        //Calculta Total weight

        var w1 = document.getElementById("weight1tot").value;
        var w2 = document.getElementById("weight2tot").value;
        document.getElementById("weighttot").value = parseFloat(w1) + parseFloat(w2);

        //Calculta 1kg cost


        var cost1 = document.getElementById("t_cost").value;
        var cost2 = document.getElementById("t_cost1").value;
        var weighttot = document.getElementById("weighttot").value;
        var sum = parseFloat(cost1) + parseFloat(cost2);
        document.getElementById("1kgcost").value = parseFloat(sum) / parseFloat(weighttot);



        //var tax_amount = (sumVal * tax_per) / 100;
        //document.getElementById("net_final").value = parseFloat(sumVal);
        //document.getElementById("tax").value = parseFloat(tax_amount);
        //document.getElementById("inc_tax").value = parseFloat(sumVal) + parseFloat(tax_amount);
    }
    function deleteRow(btn) {
        if (confirm("Are you sure want to delete the row?"))
            $(btn).closest("tr").remove();
        var table = document.getElementById("invoiceItem"), sumVal = 0;
        for (var i = 1; i < table.rows.length; i++) {
            sumVal = sumVal + parseFloat(table.rows[i].cells[8].innerHTML);
        }
        document.getElementById("weight1tot").value = sumVal;

        var tot_weight = document.getElementById("weight1tot").value;
        var table = document.getElementById("invoiceItem");
        //alert(tot_weight);
        for (var i = 1; i < table.rows.length; i++) {
            var weight = table.rows[i].cells[8].innerHTML;
            var tot = 0;
            // alert(weight);
            //alert(tot_weight);
            if (tot_weight != 0) {
                tot = (weight * 100) / tot_weight;
            }
            else {
                tot = 100.00;
            }
            table.rows[i].cells[9].innerHTML = tot.toFixed(3);
            table.rows[i].cells[10].innerHTML = '<input type="text"  name="per1"  value=' + tot.toFixed(3) + '  readonly class="form-control" autocomplete="off">';

        }

        var table = document.getElementById("invoiceItem"), sumVal = 0;
        for (var i = 1; i < table.rows.length; i++) {
            sumVal = sumVal + parseFloat(table.rows[i].cells[9].innerHTML);
        }
        document.getElementById("t_per").value = sumVal;

        var table = document.getElementById("invoiceItem"), sumVal = 0;
        for (var i = 1; i < table.rows.length; i++) {
            sumVal = sumVal + parseFloat(table.rows[i].cells[7].innerHTML);
        }
        document.getElementById("t_cost").value = sumVal;

        //Calculta Total weight

        var w1 = document.getElementById("weight1tot").value;
        var w2 = document.getElementById("weight2tot").value;
        document.getElementById("weighttot").value = parseFloat(w1) + parseFloat(w2);

        //Calculta 1kg cost

        var cost1 = document.getElementById("t_cost").value;
        var cost2 = document.getElementById("t_cost1").value;
        var weighttot = document.getElementById("weighttot").value;
        var sum = parseFloat(cost1) + parseFloat(cost2);
        document.getElementById("1kgcost").value = parseFloat(sum) / parseFloat(weighttot);
    }
    function deleteRow1(btn) {
        if (confirm("Are you sure want to delete the row?"))
            $(btn).closest("tr").remove();
        var table = document.getElementById("invoiceItem1"), sumVal = 0;
        for (var i = 1; i < table.rows.length; i++) {
            sumVal = sumVal + parseFloat(table.rows[i].cells[8].innerHTML);
        }
        document.getElementById("weight2tot").value = sumVal;

        var tot_weight = document.getElementById("weight2tot").value;
        var table = document.getElementById("invoiceItem1");
        //alert(tot_weight);
        for (var i = 1; i < table.rows.length; i++) {
            var weight = table.rows[i].cells[8].innerHTML;
            var tot = 0;
            // alert(weight);
            //alert(tot_weight);
            if (tot_weight != 0) {
                tot = (weight * 100) / tot_weight;
            }
            else {
                tot = 100.00;
            }
            table.rows[i].cells[9].innerHTML = tot.toFixed(3);
            table.rows[i].cells[10].innerHTML = '<input type="text"  name="per2"  value=' + tot.toFixed(3) + '  readonly class="form-control" autocomplete="off">';

        }

        var table = document.getElementById("invoiceItem1"), sumVal = 0;
        for (var i = 1; i < table.rows.length; i++) {
            sumVal = sumVal + parseFloat(table.rows[i].cells[9].innerHTML);
        }
        document.getElementById("t_per1").value = sumVal;

        var table = document.getElementById("invoiceItem1"), sumVal = 0;
        for (var i = 1; i < table.rows.length; i++) {
            sumVal = sumVal + parseFloat(table.rows[i].cells[7].innerHTML);
        }
        document.getElementById("t_cost1").value = sumVal;

        //Calculta Total weight

        var w1 = document.getElementById("weight1tot").value;
        var w2 = document.getElementById("weight2tot").value;
        document.getElementById("weighttot").value = parseFloat(w1) + parseFloat(w2);

        //Calculta 1kg cost


        var cost1 = document.getElementById("t_cost").value;
        var cost2 = document.getElementById("t_cost1").value;
        var weighttot = document.getElementById("weighttot").value;
        var sum = parseFloat(cost1) + parseFloat(cost2);
        document.getElementById("1kgcost").value = parseFloat(sum) / parseFloat(weighttot);
    }

    function Action3(code) {
        //alert(code);
        $.ajax({
            type: "GET",
            url: "/Batch/GetCat?value=" + code,
            data: "{}",
            success: function (data) {
              //  alert(data);
                var s = '<option value="-1">Select Item</option>';
                for (var i = 0; i < data.length; i++) {
                    s += '<option value="' + data[i].CategoryName + '">' + data[i].CategoryName + '</option>';
                }
                $('#a').html(s);
            }
        });
    }
    function Action4(code) {
      //  alert(code);
        $.ajax({
            type: "GET",
            url: "/Batch/GetProd?value=" + code,
            data: "{}",
            success: function (data) {
             //   alert(data);
                var s = '<option value="-1">Select Item</option>';
                for (var i = 0; i < data.length; i++) {
                    s += '<option value="' + data[i].ProductName + '">' + data[i].ProductName + '</option>';
                }
                $('#b').html(s);
            
            }
        });
       
      
    }
    function Action5(code) {

        $.ajax({
            type: "GET",
            url: "/Batch/GetstockValue?value=" + code,
            data: "{}",
            success: function (data) {
               //alert(data);
                var s = '<option value="-1">Select Rate</option>';
                for (var i = 0; i < data.length; i++) {
                    s += '<option value="' + data[i].cp + '">' + data[i].cp + '</option>';
                }
                $('#rate1drop').html(s);
            }
        });
    }
    function Action6(code) {
          var selObj = document.getElementById("item_name1");
          var rate = selObj.options[selObj.selectedIndex].value;
        $.ajax({
            /**/
            url: '@Url.Action("GetRemqty", "Batch")',
    /**/
    type: "POST",
            data: { "code": code, "rate": rate },

    "success": function (data) {
        if (data != null) {
            var vdata = data;
            //alert(vdata);
            $("#rem1").val(vdata[0].op + vdata[0].qty - vdata[0].qty1 - vdata[0].qtylab - vdata[0].qtybatchfilling - vdata[0].qtyreturn);
        }
    }
});
    }

    function Action66(code) {
        var selObj = document.getElementById("item_name1");
        var rate = selObj.options[selObj.selectedIndex].value;

          $.ajax({
            /**/
            url: '@Url.Action("GetRemqtyTotal", "Batch")',
        /**/
    type: "POST",
              data: { "code": rate },

    "success": function (data) {
        if (data != null) {
            var vdata = data;
            $("#rem1").val(vdata[0].qty);
        }
    }
});
    }



    $(document).ready(function () {
        var now = new Date();
        var month = (now.getMonth() + 1);
        var day = now.getDate();
        if (month < 10)
            month = "0" + month;
        if (day < 10)
            day = "0" + day;
        var today = now.getFullYear() + '-' + month + '-' + day;
        $('#date').val(today);
        //    $('#stdate').val(today);
    });
</script>
<div class="content">
    <div class="content-header">
        <div class="leftside-content-header">
            <ul class="breadcrumbs">
                <li><a><i class="fa fa-cubes" aria-hidden="true"></i> Lab</a></li>
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <h4 class="section-subtitle"><b> Lab Entreis</b></h4>
            <a href="@Url.Action("Index", "LabEntries")" class="btn btn-wide btn-success pull-right" style="margin-top:-40px"> List</a>
            <div class="panel">
                @*<form asp-action="Create" method="post" enctype="multipart/form-data" onsubmit="return confirm('Are you sure you want to Continue ?');">*@
                <form asp-action="Create" method="post" enctype="multipart/form-data" onsubmit="showLoader(this);">
                    <div class="panel-content">
                        <div class="row">
                            <div class="form-group col-sm-1" style="display:none">
                                <label>Order Id</label>
                                @Html.TextBoxFor(m => m.labMasterQuery.OrderId, new { @class = "form-control input-xs", @readonly = "readonly" })
                            </div>
                            <div class="form-group col-sm-3">
                                <label>Date</label>
                                @if (Model.labMasterQuery.OrderId == 0)
                                {
                                    @Html.TextBoxFor(m => m.labMasterQuery.Date, new { @class = "form-control input-xs", type = "date", id = "date", @readonly = "readonly" })

                                }
                                else
                                {
                                    @Html.TextBoxFor(m => m.labMasterQuery.Date, new { @class = "form-control input-xs", type = "date", @Value = Model.labMasterQuery.Date.ToString("yyyy-MM-dd"), @readonly = "readonly" })
                                }
                            </div>
                            <div class="form-group col-sm-2">
                                <label>Select Quality</label>
                                @Html.DropDownListFor(m => m.labMasterQuery.Quality, new SelectList(Model.quality, "MainCategoryName", "MainCategoryName"), "Select Quality", htmlAttributes: new { @class = "chosen-select form-control", @required = "true", @onChange = "Action3(this.value)" })
                            </div>
                            @*<div class="form-group col-sm-2">
            <label>Select Region</label>
            @Html.DropDownListFor(m => m.labMasterQuery.RegionId, new SelectList(Model.Region_list, "id", "Name"), "Select Region", htmlAttributes: new { @class = "chosen-select form-control", @required = "true" })
        </div>*@
                            <div class="form-group col-sm-2">
                                <label>Select Product Name</label>
                                <select id="a" class="form-control" name="ProductName" onChange="Action4(this.value)"></select>
                                @*@Html.DropDownListFor(m => m.productIngrMasterQuery.ProductName, new SelectList(Model.product, "CategoryName", "CategoryName"), "Select Product Name", htmlAttributes: new { @class = "chosen-select form-control", @required = "true",id = "a", @onChange = "Action4(this.value)" })*@
                            </div>
                            <div class="form-group col-sm-2">
                                <label>Select Color Name</label>
                                <select id="b" class="form-control" name="ColorName" onChange="Action2(this.value)"></select>
                                @*@Html.DropDownListFor(m => m.productIngrMasterQuery.ColorName, new SelectList(Model.color, "ProductName", "ProductName"), "Select Color", htmlAttributes: new { onChange = "Action2(this.value)", @class = "chosen-select form-control", @required = "true" })*@
                            </div>
                            <div class="form-group col-sm-2">
                                <a class="btn btn-wide btn-info pull-left" data-toggle="modal" data-target="#lg-modal1" style="width:170px;  margin-top:25px;margin-left:40px"><i class="fa fa-search-plus"></i>  Search Batch</a>
                            </div>

                            <div class="form-group col-sm-3">
                                <label>Batch No</label>
                                @Html.TextBoxFor(m => m.labMasterQuery.BatchNo, new { @class = "form-control input-xs" })
                            </div>
                            <div class="form-group col-sm-2">
                                <label>1 KG Cost</label>
                                @Html.TextBoxFor(m => m.labMasterQuery.kgcoast, new { @class = "form-control input-xs", id = "1kgcost" })
                            </div>
                            <div class="form-group col-sm-2">
                                <label>Ltr Cost</label>
                                @Html.TextBoxFor(m => m.labMasterQuery.ltrcoast, new { @class = "form-control input-xs" })
                            </div>
                            <div class="form-group col-sm-2">
                                <label>Viscocity</label>
                                @Html.TextBoxFor(m => m.labMasterQuery.viscosity, new { @class = "form-control input-xs" })
                            </div>
                            <div class="form-group col-sm-2">
                                <label>Weight/Ltr</label>
                                @Html.TextBoxFor(m => m.labMasterQuery.whc, new { @class = "form-control input-xs", id = "weighttot" })
                            </div>
                            <div class="form-group col-sm-2">
                                <label>Drum</label>
                                @Html.TextBoxFor(m => m.labMasterQuery.Drum, new { @class = "form-control input-xs" })
                            </div>
                            <div class="form-group col-sm-2">
                                <label>Gallon</label>
                                @Html.TextBoxFor(m => m.labMasterQuery.Gallon, new { @class = "form-control input-xs" })
                            </div>
                            <div class="form-group col-sm-2">
                                <label>Quarter</label>
                                @Html.TextBoxFor(m => m.labMasterQuery.Quarter, new { @class = "form-control input-xs" })
                            </div>
                            <div class="form-group col-sm-2">
                                <label>Dubbi</label>
                                @Html.TextBoxFor(m => m.labMasterQuery.Dubbi, new { @class = "form-control input-xs" })
                            </div>
                            @*<div class="form-group col-sm-3">
            <label>Total Weight</label>
            @Html.TextBoxFor(m => m.productIngrMasterQuery.totalweight, new { @class = "form-control input-xs", id = "weighttot" })
        </div>*@
                            @*<div class="form-group col-sm-3">
            <label>Yield (%)</label>
            @Html.TextBoxFor(m => m.productIngrMasterQuery.yield, new { @class = "form-control input-xs" })
        </div>*@
                            <div class="form-group col-sm-2">
                                <label>PH</label>
                                @Html.TextBoxFor(m => m.labMasterQuery.ph, new { @class = "form-control input-xs" })
                            </div>
                            @*<div class="form-group col-sm-3">
             <label>Waste Qty</label>
             Html.TextBoxFor(m => m.productIngrMasterQuery.Prdwaste, new { @class = "form-control input-xs" })
         </div>
        <div class="form-group col-sm-3">
             <label>Test By</label>
             @Html.TextBoxFor(m => m.productIngrMasterQuery.testby, new { @class = "form-control input-xs" })
         </div>
         <div class="form-group col-sm-3">
             <label>Transfered By</label>
             @Html.TextBoxFor(m => m.productIngrMasterQuery.transferedby, new { @class = "form-control input-xs" })
         </div>
         <div class="form-group col-sm-3">
             <label>Machine Operator 1</label>
             @Html.TextBoxFor(m => m.productIngrMasterQuery.machineoper1, new { @class = "form-control input-xs" })
         </div>
         <div class="form-group col-sm-3">
             <label>Machine Operator 2</label>
             @Html.TextBoxFor(m => m.productIngrMasterQuery.machineoper2, new { @class = "form-control input-xs" })
         </div>*@
                            <div class="form-group col-sm-6">
                                <label>Note</label>
                                @Html.TextBoxFor(m => m.labMasterQuery.note, new { @class = "form-control input-xs" })
                            </div>
                            <div class="form-group col-sm-3">
                                <br />
                                <label>Ready to Transfer ? </label>
                                @Html.CheckBoxFor(m => m.labMasterQuery.ready)
                                @*<input type="checkbox" name="ready" value="1" />*@
                            </div>
                            <div class="col-sm-12 col-md-12">
                                <div clas="row" style="margin-top:10px;">
                                    <div clas="col-md-12">
                                        <div class="form-group col-sm-1" style="display:none">
                                            <label>ID</label>
                                            <input type="text" id="id1" readonly class="form-control" />
                                        </div>
                                        <div class="form-group col-sm-2" style="margin-left:-20px">
                                            <label>Date</label>
                                            <input type="date" id="date1" class="form-control" Value="@DateTime.Now.ToString("yyyy-MM-dd")" />
                                        </div>
                                        <div class="form-group col-sm-3">
                                            <label>Select Product</label>
                                            @Html.DropDownListFor(m => m.labMasterQuery.ColorName, new SelectList(Model.color, "ProductID", "ProductName"), "Select Product", htmlAttributes: new { @class = "chosen-select form-control", onChange = "Action5(this.value)", @style = "margin-left:-20px", id = "item_name1" })
                                        </div>
                                        <div class="form-group col-sm-2" style="margin-left:-20px;width:150px">
                                            <label>Select Rate</label>
                                            @*<input type="text" id="rate1" onKeyUp="tota(); " class="form-control" />*@
                                            <select id="rate1drop" class="form-control" onChange="Action66(this.value)"></select>
                                        </div>
                                        <div class="form-group col-sm-2" style="margin-left:-20px;width:150px">
                                            <label>Rem-Weight</label>
                                            <input type="text" id="rem1" readonly class="form-control" />
                                        </div>
                                        <div class="form-group col-sm-2" style="margin-left:-20px;width:150px">
                                            <label>Weight</label>
                                            <input type="text" id="weight1" onKeyUp="tota();" class="form-control" />
                                        </div>
                                        <div class="form-group col-sm-2" style="display:none">
                                            <label>%</label>
                                            <input type="text" id="per1" readonly class="form-control" />

                                        </div>
                                        @*<div class="form-group col-sm-2" style="margin-left:-20px;width:150px">
                        <label>Rate</label>
                        <input type="text" id="rate1" onKeyUp="tota(); " class="form-control" />
                    </div>*@
                                        <div class="form-group col-sm-2" style="margin-left:-20px;width:150px">
                                            <label>Cost</label>
                                            <input type="text" id="cost1" readonly class="form-control" />
                                        </div>
                                        <div class="form-group col-sm-1" style="margin-top:10px">
                                            <br />
                                            <br />
                                            <a class="btn btn-wide btn-warning pull-left" onclick='return add()' style="margin-right:-130px;width:25px !important;margin-top:-32px"> <i class="fa fa-plus"></i> Add</a> &nbsp;&nbsp;
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-12" style="margin-top:-15px">
                                        <div class="table-responsive">
                                            <table id="invoiceItem" class="table table-bordered table-hover table-striped table-success">
                                                <thead class="bordered-darkorange">
                                                    <tr style="background-color:#189279;color:white">
                                                        <th>Action</th>
                                                        <th>ID</th>
                                                        <th>Date</th>
                                                        <th>Product Name</th>
                                                        <th>Weight</th>
                                                        <th>Rate</th>
                                                        <th>Cost</th>
                                                        <th>%</th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group col-sm-4">
                                    <label>Total Weight</label>
                                    <input type="text" id="weight1tot" value="0" name="Stand_total_weight" readonly class="form-control" />
                                </div>
                                <div class="form-group col-sm-4">
                                    <label>Total %</label>
                                    <input type="text" id="t_per" value="0" name="Stand_total_cost" readonly class="form-control" />
                                </div>
                                <div class="form-group col-sm-4">
                                    <label>Total Cost</label>
                                    <input type="text" id="t_cost" value="0" name="Stand_total_per" readonly class="form-control" />
                                </div>
                            </div>
                            <div class="col-sm-12">
                                @if (Session["SubLabAdd"].ToString() != "0")
                                {
                                    <button type="submit" class="btn btn-primary col-sm-4 col-sm-offset-4" style="margin-top:10px"><i class="fa fa-save"></i> &nbsp; Save Data</button>
                                }
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>



        <div class="modal fade" id="lg-modal1" aria-labelledby="modal-large-label" style="margin-top:-180px">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header state modal-primary" style="background-color: #3498DB !important">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="modal-large-label">Batch Details</h4>
                    </div>
                    <div class="modal-body">
                        <div style="width: 100%; height:480px;overflow-y: scroll;">
                            <table class="table table-bordered table-hover table-striped table-success" id="searchable">
                                <thead class="bordered-darkorange">
                                    <tr>
                                        <th>Action</th>
                                        <th>Date</th>
                                        <th>OrderId</th>
                                        <th>Weight</th>
                                        <th>Required Weight</th>
                                        <th>Color Name</th>
                                        <th>BatchNo</th>




                                    </tr>
                                </thead>

                                <tbody class="abc" id="mybatchTable">
                                    @foreach (var item in Model.ProductIngrMasterQuerylist)
                                    {
                                        var uniqueId = "enterweight_" + @item.OrderId;
                                        <tr>

                                            <td><button class="btnSelect btn btn-danger" onclick="addrecord(@item.OrderId,$('#@uniqueId').val(),@item.Stand_total_weight)" data-dismiss="modal"><i class="fa fa-check"></i></button></td>

                                            <td>@item.ready2</td>

                                            <td>@item.OrderId</td>
                                            <td>@item.Stand_total_weight</td>
                                            <td><input type="number" id="@uniqueId" name="enterweight" class="form-control"></td>
                                            <td>@item.ColorName</td>
                                            <td>@item.BatchNo</td>


                                        </tr>
                                    }
                                </tbody>
                                <tfoot>
                                    <tr>
                                        @*<th style="width:60px"><input type="text" placeholder="Search Here" name="search_browser" class="form-control input-sm" style="width:80px"></th>
                                    <th><input type="text" name="search_browser" placeholder="Search Here" class="form-control input-sm" style="width:100px"></th>*@
                                        <th><input type="text" name="search_browser" placeholder="Search Here" class="form-control input-sm"></th>
                                        <th><input type="text" name="search_browser" placeholder="Search Here" class="form-control input-sm"></th>
                                        <th><input type="text" name="search_browser" placeholder="Search Here" class="form-control input-sm"></th>
                                        <th><input type="text" name="search_browser" placeholder="Search Here" class="form-control input-sm"></th>
                                        <th><input type="text" name="search_browser" placeholder="Search Here" class="form-control input-sm"></th>
                                        <th><input type="text" name="search_browser" placeholder="Search Here" class="form-control input-sm"></th>
                                        <th><input type="text" name="search_browser" placeholder="Search Here" class="form-control input-sm"></th>
                                    </tr>
                                </tfoot>
                            </table>

                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        

        @*<div class="modal fade" id="lg-modal" aria-labelledby="modal-large-label" style="margin-top:-180px">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header state modal-primary" style="background-color: #3498DB !important">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="modal-large-label">Product Details</h4>
                    </div>
                    <div class="modal-body">
                        <div style="width: 100%; height:480px;overflow-y: scroll;">
                            <table class="table table-bordered table-hover table-striped table-success" id="searchable">
                                <thead class="bordered-darkorange">
                                    <tr>
                                        <th>ID</th>
                                        <th>Product Name</th>
                                        <th>Unit Price</th>
                                        <th>Action</th>

                                    </tr>
                                </thead>

                                <tbody class="abc" id="myTable">
                                    @foreach (var item in Model.color)
                                    {
                                        <tr>
                                            <td>@item.ProductID</td>
                                            <td>@item.ProductName</td>
                                            <td>@item.UnitPrice</td>
                                            <td><button class="btnSelect btn btn-danger" data-dismiss="modal"><i class="fa fa-check"></i></button></td>
                                        </tr>
                                    }
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <th style="width:60px"><input type="text" placeholder="Search Here" name="search_browser" class="form-control input-sm" style="width:80px"></th>
                                        <th><input type="text" name="search_browser" placeholder="Search Here" class="form-control input-sm" style="width:100px"></th>
                                        <th><input type="text" name="search_browser" placeholder="Search Here" class="form-control input-sm"></th>
                                        <th><input type="text" name="search_browser" placeholder="Search Here" class="form-control input-sm"></th>
                                    </tr>
                                </tfoot>
                            </table>

                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>*@
